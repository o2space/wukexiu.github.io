<!DOCTYPE html>






  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="CAShapeLayer 是 CALayer 的子类，但是比 CALayer 更灵活，可以画出各种图形。  别忘记引入QuartzCore.framework  样例在 CAShapeLayer 中，也可以像 CALayer 一样指定它的 frame 来画，就像这样： 123456- (void) Demo01View&amp;#123;    CAShapeLayer *layer = [CAShape">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="UIBezierPath和CAShapeLayer应用">
<meta property="og:url" content="http://yoursite.com/2016/12/08/ios-uibezierpath-cashapelayer/index.html">
<meta property="og:site_name" content="打工仔-吴克修のCODE有毒">
<meta property="og:description" content="CAShapeLayer 是 CALayer 的子类，但是比 CALayer 更灵活，可以画出各种图形。  别忘记引入QuartzCore.framework  样例在 CAShapeLayer 中，也可以像 CALayer 一样指定它的 frame 来画，就像这样： 123456- (void) Demo01View&amp;#123;    CAShapeLayer *layer = [CAShape">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-5418e131ca2b6f65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-d2060b82b247db99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-2be296fca41e84ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-704d890bd9702059.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-ddbcad862b3c82ae.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2908476-37b823582db44d58.gif?imageMogr2/auto-orient/strip">
<meta property="og:updated_time" content="2018-06-26T13:42:53.395Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UIBezierPath和CAShapeLayer应用">
<meta name="twitter:description" content="CAShapeLayer 是 CALayer 的子类，但是比 CALayer 更灵活，可以画出各种图形。  别忘记引入QuartzCore.framework  样例在 CAShapeLayer 中，也可以像 CALayer 一样指定它的 frame 来画，就像这样： 123456- (void) Demo01View&amp;#123;    CAShapeLayer *layer = [CAShape">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/2908476-5418e131ca2b6f65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372">






  <link rel="canonical" href="http://yoursite.com/2016/12/08/ios-uibezierpath-cashapelayer/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>UIBezierPath和CAShapeLayer应用 | 打工仔-吴克修のCODE有毒</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">打工仔-吴克修のCODE有毒</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">工作不止眼前的需求和Bug，还有诗和远方。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/08/ios-uibezierpath-cashapelayer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="吴克修">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="打工仔-吴克修のCODE有毒">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">UIBezierPath和CAShapeLayer应用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-12-08 00:05:19" itemprop="dateCreated datePublished" datetime="2016-12-08T00:05:19+08:00">2016-12-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-06-26 21:42:53" itemprop="dateModified" datetime="2018-06-26T21:42:53+08:00">2018-06-26</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>CAShapeLayer 是 CALayer 的子类，但是比 CALayer 更灵活，可以画出各种图形。</p>
<blockquote>
<p>别忘记引入QuartzCore.framework</p>
</blockquote>
<h4 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h4><p>在 CAShapeLayer 中，也可以像 CALayer 一样指定它的 frame 来画，就像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void) Demo01View&#123;</span><br><span class="line">    CAShapeLayer *layer = [CAShapeLayer layer];</span><br><span class="line">    layer.frame = CGRectMake(110, 100, 150, 100);</span><br><span class="line">    layer.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-5418e131ca2b6f65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372" alt="Demo01View"></p>
<p>但是，CAShapeLayer 有一个神奇的属性 path 用这个属性配合上 UIBezierPath 这个类就可以达到超神的效果。  </p>
<p>UIBezierPath 顾名思义，这是用贝塞尔曲线的方式来构建一段弧线，你可以用任意条弧线来组成你想要的形状，比如，你想用它来和上面一样画一个矩形，那就可以这样子来做：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (void) Demo02View&#123;</span><br><span class="line">    //矩形</span><br><span class="line">    UIBezierPath *path01 = [UIBezierPath bezierPathWithRect:CGRectMake(110, 100, 150, 100)];</span><br><span class="line">    CAShapeLayer *layer01 = [CAShapeLayer layer];</span><br><span class="line">    layer01.path = path01.CGPath;</span><br><span class="line">    layer01.fillColor = [UIColor clearColor].CGColor;//填充颜色 不要使用backgroundColor属性</span><br><span class="line">    layer01.strokeColor = [UIColor blackColor].CGColor;//边框颜色</span><br><span class="line">    [self.view.layer addSublayer:layer01];</span><br><span class="line">    </span><br><span class="line">    //圆角矩形</span><br><span class="line">    UIBezierPath *path02 = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(110, 235, 150, 100) cornerRadius:50];</span><br><span class="line">    CAShapeLayer *layer02 = [CAShapeLayer layer];</span><br><span class="line">    layer02.path = path02.CGPath;</span><br><span class="line">    layer02.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">    layer02.strokeColor = [UIColor blackColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer02];</span><br><span class="line">    </span><br><span class="line">    //圆 顺时针</span><br><span class="line">    CGFloat radius = 60.0;//半径</span><br><span class="line">    CGFloat startAngle = 0.0;//开始角度</span><br><span class="line">    CGFloat endAngle = (M_PI * 2);//结束角度</span><br><span class="line">    UIBezierPath *path03 = [UIBezierPath bezierPathWithArcCenter:CGPointMake([UIScreen mainScreen].bounds.size.width/2.0, 430.0) radius:radius startAngle:startAngle endAngle:endAngle clockwise:YES];</span><br><span class="line">    CAShapeLayer *layer03 = [CAShapeLayer layer];</span><br><span class="line">    layer03.path = path03.CGPath;</span><br><span class="line">    layer03.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">    layer03.strokeColor = [UIColor blackColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer03];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-d2060b82b247db99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372" alt="Demo02View"></p>
<h4 id="画曲线"><a href="#画曲线" class="headerlink" title="画曲线"></a>画曲线</h4><p>贝塞尔曲线的画法是由起点、终点、控制点三个参数来画的，为了解释清楚这个点，我写了几行代码来解释它  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void) Demo03View&#123;</span><br><span class="line">    CGPoint startPoint = CGPointMake(50, 300);</span><br><span class="line">    CGPoint endPoint = CGPointMake(300, 300);</span><br><span class="line">    CGPoint controlPoint = CGPointMake(170, 200);</span><br><span class="line">    </span><br><span class="line">    CALayer *layer1 = [CALayer layer];</span><br><span class="line">    layer1.frame = CGRectMake(startPoint.x, startPoint.y, 5, 5);</span><br><span class="line">    layer1.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    CALayer *layer2 = [CALayer layer];</span><br><span class="line">    layer2.frame = CGRectMake(endPoint.x, endPoint.y, 5, 5);</span><br><span class="line">    layer2.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    CALayer *layer3 = [CALayer layer];</span><br><span class="line">    layer3.frame = CGRectMake(controlPoint.x, controlPoint.y, 5, 5);</span><br><span class="line">    layer3.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    UIBezierPath *path = [UIBezierPath bezierPath];</span><br><span class="line">    CAShapeLayer *layer = [CAShapeLayer layer];</span><br><span class="line">    </span><br><span class="line">    [path moveToPoint:startPoint];//移动到起始点</span><br><span class="line">    [path addQuadCurveToPoint:endPoint controlPoint:controlPoint];//结束点和控制点</span><br><span class="line">    //CGPoint controlPoint1 = CGPointMake(133, 200);</span><br><span class="line">    //CGPoint controlPoint2 = CGPointMake(216, 400);</span><br><span class="line">    //[path addCurveToPoint:endPoint controlPoint1:controlPoint1 controlPoint2:controlPoint2];//使用两个控制点来画</span><br><span class="line">    </span><br><span class="line">    layer.path = path.CGPath;</span><br><span class="line">    layer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">    layer.strokeColor = [UIColor blackColor].CGColor;</span><br><span class="line">    </span><br><span class="line">    [self.view.layer addSublayer:layer];</span><br><span class="line">    [self.view.layer addSublayer:layer1];</span><br><span class="line">    [self.view.layer addSublayer:layer2];</span><br><span class="line">    [self.view.layer addSublayer:layer3];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-2be296fca41e84ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372" alt="Demo03View"></p>
<h3 id="CAShapeLayer动画"><a href="#CAShapeLayer动画" class="headerlink" title="CAShapeLayer动画"></a>CAShapeLayer动画</h3><p>动画使用 strokeEnd  strokeStart  lineWidth三个属性  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// layer是贝塞尔曲线</span><br><span class="line">// 线从开始点到结束点逐渐显示</span><br><span class="line">- (void) animation01:(CAShapeLayer *)layer&#123;</span><br><span class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath: @&quot;strokeEnd&quot;];</span><br><span class="line">    animation.fromValue = @0;</span><br><span class="line">    animation.toValue = @1;</span><br><span class="line">    animation.duration = 2.0;</span><br><span class="line">    [layer addAnimation:animation forKey:@&quot;&quot;];</span><br><span class="line">&#125;</span><br><span class="line">// 线从中间向两边逐渐显示</span><br><span class="line">- (void) animation02:(CAShapeLayer *)layer&#123;</span><br><span class="line">    layer.strokeStart = 0.5;</span><br><span class="line">    layer.strokeEnd = 0.5;</span><br><span class="line">    </span><br><span class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;strokeStart&quot;];</span><br><span class="line">    animation.fromValue = @0.5;</span><br><span class="line">    animation.toValue = @0;</span><br><span class="line">    animation.duration = 2.0;</span><br><span class="line">    </span><br><span class="line">    CABasicAnimation *animation2 = [CABasicAnimation animationWithKeyPath: @&quot;strokeEnd&quot;];</span><br><span class="line">    animation2.fromValue = @(0.5);</span><br><span class="line">    animation2.toValue = @1;</span><br><span class="line">    animation2.duration = 2.0;</span><br><span class="line">    </span><br><span class="line">    [layer addAnimation:animation forKey:@&quot;&quot;];</span><br><span class="line">    [layer addAnimation:animation2 forKey:@&quot;&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 线条变粗</span><br><span class="line">- (void) animation03:(CAShapeLayer *)layer&#123;</span><br><span class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath: @&quot;lineWidth&quot;];</span><br><span class="line">    animation.fromValue = @1;</span><br><span class="line">    animation.toValue = @10;</span><br><span class="line">    animation.duration = 2.0;</span><br><span class="line">    [layer addAnimation:animation forKey:@&quot;&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">- (void) Demo04View&#123;</span><br><span class="line">    CGSize finalSize = CGSizeMake(CGRectGetWidth(self.view.frame), 400);</span><br><span class="line">    CGFloat layerHeight = finalSize.height * 0.2;</span><br><span class="line">    CAShapeLayer *layer = [CAShapeLayer layer];</span><br><span class="line">    UIBezierPath *bezier = [UIBezierPath bezierPath];</span><br><span class="line">    [bezier moveToPoint:CGPointMake(0, finalSize.height - layerHeight)];</span><br><span class="line">    [bezier addLineToPoint:CGPointMake(0, finalSize.height - 1)];</span><br><span class="line">    [bezier addLineToPoint:CGPointMake(finalSize.width, finalSize.height - 1)];</span><br><span class="line">    [bezier addLineToPoint:CGPointMake(finalSize.width, finalSize.height - layerHeight)];</span><br><span class="line">    [bezier addQuadCurveToPoint:CGPointMake(0,finalSize.height - layerHeight) controlPoint:CGPointMake(finalSize.width / 2, (finalSize.height - layerHeight) - 40)];</span><br><span class="line">    layer.path = bezier.CGPath;</span><br><span class="line">    layer.fillColor = [UIColor blackColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    //描点</span><br><span class="line">    CALayer *layer1 = [CALayer layer];</span><br><span class="line">    layer1.frame = CGRectMake(0, finalSize.height - layerHeight, 5, 5);</span><br><span class="line">    layer1.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer1];</span><br><span class="line">    </span><br><span class="line">    CALayer *layer2 = [CALayer layer];</span><br><span class="line">    layer2.frame = CGRectMake(0, finalSize.height - 1, 5, 5);</span><br><span class="line">    layer2.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer2];</span><br><span class="line">    </span><br><span class="line">    CALayer *layer3 = [CALayer layer];</span><br><span class="line">    layer3.frame = CGRectMake(finalSize.width-5, finalSize.height - 1, 5, 5);</span><br><span class="line">    layer3.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer3];</span><br><span class="line">    </span><br><span class="line">    CALayer *layer4 = [CALayer layer];</span><br><span class="line">    layer4.frame = CGRectMake(finalSize.width-5, finalSize.height - layerHeight, 5, 5);</span><br><span class="line">    layer4.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer4];</span><br><span class="line">    </span><br><span class="line">    CALayer *layer5 = [CALayer layer];</span><br><span class="line">    layer5.frame = CGRectMake(finalSize.width / 2, (finalSize.height - layerHeight) - 40, 5, 5);</span><br><span class="line">    layer5.backgroundColor = [UIColor redColor].CGColor;</span><br><span class="line">    [self.view.layer addSublayer:layer5];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-704d890bd9702059.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/372" alt="Demo04View"></p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>微信小眼睛<br>.h文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface WXPullView : UIView</span><br><span class="line"></span><br><span class="line">- (void)animationWith:(CGFloat)y;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>.m文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WXPullView.h&quot;</span><br><span class="line"></span><br><span class="line">@interface WXPullView ()</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) CAShapeLayer *eyeFirstLightLayer;</span><br><span class="line">@property (strong, nonatomic) CAShapeLayer *eyeSecondLightLayer;</span><br><span class="line">@property (strong, nonatomic) CAShapeLayer *eyeballLayer;</span><br><span class="line">@property (strong, nonatomic) CAShapeLayer *topEyesocketLayer;</span><br><span class="line">@property (strong, nonatomic) CAShapeLayer *bottomEyesocketLayer;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WXPullView</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self.layer addSublayer:self.eyeFirstLightLayer];</span><br><span class="line">        [self.layer addSublayer:self.eyeSecondLightLayer];</span><br><span class="line">        [self.layer addSublayer:self.eyeballLayer];</span><br><span class="line">        [self.layer addSublayer:self.topEyesocketLayer];</span><br><span class="line">        [self.layer addSublayer:self.bottomEyesocketLayer];</span><br><span class="line">        [self setupAnimation];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)eyeFirstLightLayer &#123;</span><br><span class="line">    if (!_eyeFirstLightLayer) &#123;</span><br><span class="line">        _eyeFirstLightLayer = [CAShapeLayer layer];</span><br><span class="line">        CGPoint center = CGPointMake(CGRectGetWidth(self.frame) / 2, CGRectGetHeight(self.frame) / 2);</span><br><span class="line">        UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:center radius:CGRectGetWidth(self.frame) * 0.2 startAngle:(230.f / 180.f) * M_PI endAngle:(265.f / 180.f) * M_PI clockwise:YES];</span><br><span class="line">        _eyeFirstLightLayer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">        _eyeFirstLightLayer.lineWidth = 5.f;</span><br><span class="line">        _eyeFirstLightLayer.path = path.CGPath;</span><br><span class="line">        _eyeFirstLightLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">        _eyeFirstLightLayer.strokeColor = [UIColor whiteColor].CGColor;</span><br><span class="line">    &#125;</span><br><span class="line">    return _eyeFirstLightLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)eyeSecondLightLayer &#123;</span><br><span class="line">    if (!_eyeSecondLightLayer) &#123;</span><br><span class="line">        _eyeSecondLightLayer = [CAShapeLayer layer];</span><br><span class="line">        CGPoint center = CGPointMake(CGRectGetWidth(self.frame) / 2, CGRectGetHeight(self.frame) / 2);</span><br><span class="line">        UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:center radius:CGRectGetWidth(self.frame) * 0.2 startAngle:(211.f / 180.f) * M_PI endAngle:(220.f / 180.f) * M_PI clockwise:YES];</span><br><span class="line">        _eyeSecondLightLayer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">        _eyeSecondLightLayer.lineWidth = 5.f;</span><br><span class="line">        _eyeSecondLightLayer.path = path.CGPath;</span><br><span class="line">        _eyeSecondLightLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">        _eyeSecondLightLayer.strokeColor = [UIColor whiteColor].CGColor;</span><br><span class="line">    &#125;</span><br><span class="line">    return _eyeSecondLightLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)eyeballLayer &#123;</span><br><span class="line">    if (!_eyeballLayer) &#123;</span><br><span class="line">        _eyeballLayer = [CAShapeLayer layer];</span><br><span class="line">        CGPoint center = CGPointMake(CGRectGetWidth(self.frame) / 2, CGRectGetHeight(self.frame) / 2);</span><br><span class="line">        UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:center radius:CGRectGetWidth(self.frame) * 0.3 startAngle:(0.f / 180.f) * M_PI endAngle:(360.f / 180.f) * M_PI clockwise:YES];</span><br><span class="line">        _eyeballLayer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">        _eyeballLayer.lineWidth = 1.f;</span><br><span class="line">        _eyeballLayer.path = path.CGPath;</span><br><span class="line">        _eyeballLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">        _eyeballLayer.strokeColor = [UIColor whiteColor].CGColor;</span><br><span class="line">        _eyeballLayer.anchorPoint = CGPointMake(0.5, 0.5);</span><br><span class="line">    &#125;</span><br><span class="line">    return _eyeballLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)topEyesocketLayer &#123;</span><br><span class="line">    if (!_topEyesocketLayer) &#123;</span><br><span class="line">        _topEyesocketLayer = [CAShapeLayer layer];</span><br><span class="line">        CGPoint center = CGPointMake(CGRectGetWidth(self.frame) / 2, CGRectGetHeight(self.frame) / 2);</span><br><span class="line">        UIBezierPath *path = [UIBezierPath bezierPath];</span><br><span class="line">        [path moveToPoint:CGPointMake(0, CGRectGetHeight(self.frame) / 2)];</span><br><span class="line">        [path addQuadCurveToPoint:CGPointMake(CGRectGetWidth(self.frame), CGRectGetHeight(self.frame) / 2) controlPoint:CGPointMake(CGRectGetWidth(self.frame) / 2, center.y - center.y - 20)];</span><br><span class="line">        _topEyesocketLayer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">        _topEyesocketLayer.lineWidth = 1.f;</span><br><span class="line">        _topEyesocketLayer.path = path.CGPath;</span><br><span class="line">        _topEyesocketLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">        _topEyesocketLayer.strokeColor = [UIColor whiteColor].CGColor;</span><br><span class="line">    &#125;</span><br><span class="line">    return _topEyesocketLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)bottomEyesocketLayer &#123;</span><br><span class="line">    if (!_bottomEyesocketLayer) &#123;</span><br><span class="line">        _bottomEyesocketLayer = [CAShapeLayer layer];</span><br><span class="line">        CGPoint center = CGPointMake(CGRectGetWidth(self.frame) / 2, CGRectGetHeight(self.frame) / 2);</span><br><span class="line">        UIBezierPath *path = [UIBezierPath bezierPath];</span><br><span class="line">        [path moveToPoint:CGPointMake(0, CGRectGetHeight(self.frame) / 2)];</span><br><span class="line">        [path addQuadCurveToPoint:CGPointMake(CGRectGetWidth(self.frame), CGRectGetHeight(self.frame) / 2) controlPoint:CGPointMake(CGRectGetWidth(self.frame) / 2, center.y + center.y + 20)];</span><br><span class="line">        _bottomEyesocketLayer.borderColor = [UIColor blackColor].CGColor;</span><br><span class="line">        _bottomEyesocketLayer.lineWidth = 1.f;</span><br><span class="line">        _bottomEyesocketLayer.path = path.CGPath;</span><br><span class="line">        _bottomEyesocketLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">        _bottomEyesocketLayer.strokeColor = [UIColor whiteColor].CGColor;</span><br><span class="line">    &#125;</span><br><span class="line">    return _bottomEyesocketLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupAnimation &#123;</span><br><span class="line">    self.eyeFirstLightLayer.lineWidth = 0.f;</span><br><span class="line">    self.eyeSecondLightLayer.lineWidth = 0.f;</span><br><span class="line">    self.eyeballLayer.opacity = 0.f;</span><br><span class="line">    _bottomEyesocketLayer.strokeStart = 0.5f;</span><br><span class="line">    _bottomEyesocketLayer.strokeEnd = 0.5f;</span><br><span class="line">    _topEyesocketLayer.strokeStart = 0.5f;</span><br><span class="line">    _topEyesocketLayer.strokeEnd = 0.5f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)animationWith:(CGFloat)y &#123;</span><br><span class="line">    CGFloat flag = self.frame.origin.y * 2.f - 20.f;</span><br><span class="line">    if (y &lt; flag) &#123;</span><br><span class="line">        if (self.eyeFirstLightLayer.lineWidth &lt; 5.f) &#123;</span><br><span class="line">            self.eyeFirstLightLayer.lineWidth += 1.f;</span><br><span class="line">            self.eyeSecondLightLayer.lineWidth += 1.f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y &lt; flag - 20) &#123;</span><br><span class="line">        if (self.eyeballLayer.opacity &lt;= 1.0f) &#123;</span><br><span class="line">            self.eyeballLayer.opacity += 0.1f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (y &lt; flag - 40) &#123;</span><br><span class="line">        if (self.topEyesocketLayer.strokeEnd &lt; 1.f &amp;&amp; self.topEyesocketLayer.strokeStart &gt; 0.f) &#123;</span><br><span class="line">            self.topEyesocketLayer.strokeEnd += 0.1f;</span><br><span class="line">            self.topEyesocketLayer.strokeStart -= 0.1f;</span><br><span class="line">            self.bottomEyesocketLayer.strokeEnd += 0.1f;</span><br><span class="line">            self.bottomEyesocketLayer.strokeStart -= 0.1f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (y &gt; flag - 40) &#123;</span><br><span class="line">        if (self.topEyesocketLayer.strokeEnd &gt; 0.5f &amp;&amp; self.topEyesocketLayer.strokeStart &lt; 0.5f) &#123;</span><br><span class="line">            self.topEyesocketLayer.strokeEnd -= 0.1f;</span><br><span class="line">            self.topEyesocketLayer.strokeStart += 0.1f;</span><br><span class="line">            self.bottomEyesocketLayer.strokeEnd -= 0.1f;</span><br><span class="line">            self.bottomEyesocketLayer.strokeStart += 0.1f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (y &gt; flag - 20) &#123;</span><br><span class="line">        if (self.eyeballLayer.opacity &gt;= 0.0f) &#123;</span><br><span class="line">            self.eyeballLayer.opacity -= 0.1f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (y &gt; flag) &#123;</span><br><span class="line">        if (self.eyeFirstLightLayer.lineWidth &gt; 0.f) &#123;   </span><br><span class="line">            self.eyeFirstLightLayer.lineWidth -= 1.f;</span><br><span class="line">            self.eyeSecondLightLayer.lineWidth -= 1.f;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-ddbcad862b3c82ae.gif?imageMogr2/auto-orient/strip" alt="微信小眼睛WXPullView.gif"></p>
<p>彩虹进度条<br>.h文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface RainbowProgress : UIView</span><br><span class="line"></span><br><span class="line">//Progress 高度</span><br><span class="line">@property (nonatomic,assign)CGFloat progressHeigh;</span><br><span class="line"></span><br><span class="line">//Progress Value (0~1)</span><br><span class="line">@property (nonatomic,assign)CGFloat progressValue;</span><br><span class="line"></span><br><span class="line">/** 开始动画过程 */</span><br><span class="line">- (void)startAnimating;</span><br><span class="line">/** 结束动画过程 */</span><br><span class="line">- (void)stopAnimating;</span><br></pre></td></tr></table></figure>
<p>.m文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;RainbowProgress.h&quot;</span><br><span class="line"></span><br><span class="line">@interface RainbowProgress ()&lt;CAAnimationDelegate&gt;</span><br><span class="line"></span><br><span class="line">/** Animating */</span><br><span class="line">@property (nonatomic,assign,getter=isAnimating)BOOL animating;</span><br><span class="line"></span><br><span class="line">/** CAShapeLayer */</span><br><span class="line">@property (nonatomic,weak)CAShapeLayer *shapeMaskLayer;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation RainbowProgress</span><br><span class="line"></span><br><span class="line">#pragma mark - 将UIView默认的CALayer替换成CAGradientLayer</span><br><span class="line">+(Class)layerClass&#123;</span><br><span class="line">    return [CAGradientLayer class];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 初始化方法</span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame&#123;</span><br><span class="line">    CGRect originFrame = CGRectMake(0, self.progressHeigh, [UIScreen mainScreen].bounds.size.width, 2);</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.frame = originFrame;</span><br><span class="line">        </span><br><span class="line">        [self setUpRainbowLayer];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line">-(void)setUpRainbowLayer&#123;</span><br><span class="line">    // 1、创建CAGradientLayer彩虹条颜色层，彩虹颜色当然需要数组存储</span><br><span class="line">    CAGradientLayer* gradientLayer = (CAGradientLayer*)self.layer;</span><br><span class="line">    [gradientLayer setStartPoint:CGPointMake(0, 0)];</span><br><span class="line">    [gradientLayer setEndPoint:CGPointMake(1, 0.01)];</span><br><span class="line">    //gradientLayer.locations = @[@(0.001),@(0.001),@(0.001)];</span><br><span class="line">    NSMutableArray *rainBowColors = [NSMutableArray array];</span><br><span class="line">    for (NSInteger hue = 0; hue &lt;= 360; hue += 5) &#123;</span><br><span class="line">        UIColor *color = [UIColor colorWithHue:1.0*hue/360.0</span><br><span class="line">                                    saturation:1.0</span><br><span class="line">                                    brightness:1.0</span><br><span class="line">                                         alpha:1.0];</span><br><span class="line">        [rainBowColors addObject:(id)color.CGColor];</span><br><span class="line">    &#125;</span><br><span class="line">    gradientLayer.colors = [NSArray arrayWithArray:rainBowColors];</span><br><span class="line">    </span><br><span class="line">    // 2、创建遮罩层 同时也需要贝塞尔曲线</span><br><span class="line">    UIBezierPath* shapePath = [UIBezierPath bezierPath];</span><br><span class="line">    [shapePath moveToPoint:CGPointMake(0, 0)];</span><br><span class="line">    [shapePath addLineToPoint:CGPointMake(self.bounds.size.width, 0)];</span><br><span class="line">    </span><br><span class="line">    CAShapeLayer* shapeMaskLayer = [CAShapeLayer layer];</span><br><span class="line">    </span><br><span class="line">    shapeMaskLayer.path = shapePath.CGPath;</span><br><span class="line">    shapeMaskLayer.lineWidth = 4.f;</span><br><span class="line">    shapeMaskLayer.fillColor = [UIColor clearColor].CGColor;</span><br><span class="line">    shapeMaskLayer.strokeColor = [UIColor blackColor].CGColor;</span><br><span class="line">    // 设置shapeMaskLayer的起止点初始值均为0</span><br><span class="line">    shapeMaskLayer.strokeStart = 0;</span><br><span class="line">    shapeMaskLayer.strokeEnd = 0;</span><br><span class="line">    gradientLayer.mask = shapeMaskLayer;</span><br><span class="line">    </span><br><span class="line">    self.shapeMaskLayer = shapeMaskLayer;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - 执行动画的过程</span><br><span class="line">-(void)performAnimation&#123;</span><br><span class="line">    // Update the colors on the model layer</span><br><span class="line">    </span><br><span class="line">    CAGradientLayer *layer = (id)[self layer];</span><br><span class="line">    NSArray *fromColors = [layer colors];</span><br><span class="line">    NSArray *toColors = [self shiftColors:fromColors];</span><br><span class="line">    [layer setColors:toColors];</span><br><span class="line">    </span><br><span class="line">    // Create an animation to slowly move the hue gradient left to right.</span><br><span class="line">    </span><br><span class="line">    CABasicAnimation *animation;</span><br><span class="line">    animation = [CABasicAnimation animationWithKeyPath:@&quot;colors&quot;];</span><br><span class="line">    [animation setFromValue:fromColors];</span><br><span class="line">    [animation setToValue:toColors];</span><br><span class="line">    [animation setDuration:0.08];                   // CALayer的color切换时间是0.08</span><br><span class="line">    [animation setRemovedOnCompletion:YES];         // 动画完成后是否要移除</span><br><span class="line">    [animation setFillMode:kCAFillModeForwards];</span><br><span class="line">    [animation setTimingFunction:[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear]];</span><br><span class="line">    [animation setDelegate:self];</span><br><span class="line">    </span><br><span class="line">    // Add the animation to our layer</span><br><span class="line">    [layer addAnimation:animation forKey:@&quot;animateGradient&quot;];</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line"> 当动画在活动时间内完成或者是从层对象中移除这个代理方法会被调用，如果动画直到它的活动时间末尾没有被移除，那这个&apos;flag&apos;是true的。</span><br><span class="line"> 回调和布尔值来保证动画的循环开始并持续以及结束该动画</span><br><span class="line"> */</span><br><span class="line">- (void)animationDidStop:(CAAnimation *)animation finished:(BOOL)flag &#123;</span><br><span class="line">    // 当动画在duration时间结束前移除了，这个方法会被调用</span><br><span class="line">    // 然后就下面的if语句判断，如果isAnimation = yes，就重新执行performAnimation</span><br><span class="line">    // 在这个performAnimation中重新创建了核心动画对象，重新设置了代理</span><br><span class="line">    if ([self isAnimating]) &#123;</span><br><span class="line">        [self performAnimation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)startAnimating &#123;</span><br><span class="line">    if (![self isAnimating]) &#123;</span><br><span class="line">        self.animating = YES;</span><br><span class="line">        [self performAnimation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)stopAnimating &#123;</span><br><span class="line">    if ([self isAnimating]) &#123;</span><br><span class="line">        self.animating = NO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - 辅助方法：转移可变数组最后一个元素到数组的最前面</span><br><span class="line">- (NSArray *)shiftColors:(NSArray *)colors &#123;</span><br><span class="line">    // Moves the last item in the array to the front</span><br><span class="line">    // shifting all the other elements.</span><br><span class="line">    // 数组中最后一项移动到前面</span><br><span class="line">    // 转移的所有其他元素</span><br><span class="line">    NSMutableArray *mutable = [colors mutableCopy];// 将NSArray数组换成 NSMutableArray</span><br><span class="line">    id last = [mutable lastObject]; // 单独取出最后一个元素</span><br><span class="line">    [mutable removeLastObject];              // 然后将数组中的最后一个元素去除</span><br><span class="line">    [mutable insertObject:last atIndex:0];   // 然后将取出的元素插入到最前面</span><br><span class="line">    return [NSArray arrayWithArray:mutable];</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - 重写set和get方法</span><br><span class="line">// 重设进度条在父控件的高度位置</span><br><span class="line">@synthesize progressHeigh = _progressHeigh;</span><br><span class="line">-(void)setProgressHeigh:(CGFloat)progressHeigh&#123;</span><br><span class="line">    _progressHeigh = progressHeigh;</span><br><span class="line">    // 就要重新设置RainbowProgress这个自定义UIView的高度</span><br><span class="line">    CGRect frame = self.frame;</span><br><span class="line">    frame.origin.y = _progressHeigh;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line">-(CGFloat)progressHeigh&#123;</span><br><span class="line">    if (!_progressHeigh) &#123;</span><br><span class="line">        _progressHeigh = 22;</span><br><span class="line">    &#125;</span><br><span class="line">    return _progressHeigh;</span><br><span class="line">&#125;</span><br><span class="line">// 设置进度条的值</span><br><span class="line">@synthesize progressValue = _progressValue;</span><br><span class="line">-(void)setProgressValue:(CGFloat)progressValue&#123;</span><br><span class="line">    progressValue = progressValue &gt; 1 ? 1 : progressValue;</span><br><span class="line">    progressValue = progressValue &lt; 0 ? 0 : progressValue;</span><br><span class="line">    _progressValue = progressValue;</span><br><span class="line">    self.shapeMaskLayer.strokeEnd = _progressValue;</span><br><span class="line">&#125;</span><br><span class="line">-(CGFloat)progressValue&#123;</span><br><span class="line">    return _progressValue;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2908476-37b823582db44d58.gif?imageMogr2/auto-orient/strip" alt="彩虹进度条 RainbowProgress.gif"></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/28/ios-networkRequest/" rel="next" title="iOS原生网络请求">
                <i class="fa fa-chevron-left"></i> iOS原生网络请求
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/18/ios-sdk-care/" rel="prev" title="iOS SDK注意事项">
                iOS SDK注意事项 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="吴克修" />
            
              <p class="site-author-name" itemprop="name">吴克修</p>
              <p class="site-description motion-element" itemprop="description">iOS开发 宅男 π</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#样例"><span class="nav-number">1.</span> <span class="nav-text">样例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#画曲线"><span class="nav-number">2.</span> <span class="nav-text">画曲线</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CAShapeLayer动画"><span class="nav-number"></span> <span class="nav-text">CAShapeLayer动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用"><span class="nav-number"></span> <span class="nav-text">应用</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴克修</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
